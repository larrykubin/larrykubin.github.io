{"data":{"site":{"siteMetadata":{"title":"larry kubin","author":"Larry Kubin"}},"markdownRemark":{"id":"dfd9d436-6888-54ed-9c2b-ba90c7875f5f","excerpt":"After a long hiatus from PHP, I am now working on a large PHP codebase, so it’s time for me to get up to speed with some of the modern PHP…","html":"<p>After a long hiatus from PHP, I am now working on a large PHP codebase, so it’s time for me to get up to speed with some of the modern PHP frameworks like\n<a href=\"https://lumen.laravel.com/\">Lumen</a>, <a href=\"https://laravel.com\">Laravel</a>, and <a href=\"https://www.slimframework.com/\">Slim</a>. I just set up a\nnew personal site using gatsby.js that I will be using for hobby projects, and I’ll use PHP to develop any backend services needed for these projects. </p>\n<h2>Linode</h2>\n<p>I’ve been using <a href=\"https://www.linode.com/\">Linode</a> for years without any major issues, so I signed up for a new server with them. I’m starting with a cheap $5/month server, which should be sufficient for my purposes.\nI selected an Ubuntu 18.04 LTS image, booted it up, and was running in a few minutes. After updating packages, I ran a few commands to install nginx, PHP, and MariaDB.</p>\n<h3>Installing nginx, MariaDB, and PHP</h3>\n<h4>nginx</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> apt <span class=\"token function\">install</span> nginx</code></pre></div>\n<h4>mariadb</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> apt <span class=\"token function\">install</span> mariadb-server\n<span class=\"token function\">sudo</span> mysql_secure_installation</code></pre></div>\n<h4>php</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> apt-install php-mysql\n<span class=\"token function\">sudo</span> apt <span class=\"token function\">install</span> php-fpm</code></pre></div>\n<h3>Configuring a new website</h3>\n<p>After all of the necessary components were installed, I created a new directory to host any PHP scripts. I will be using my personal domain for this site.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> -p /var/www/html/larrykubin.com/public_html</code></pre></div>\n<p>Next up: adding an nginx configuration. I specified the server name and the root of the public_html directory I just created, then enabled the config.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">vi</span> /etc/nginx/sites-available/larrykubin.com.conf</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre class=\"language-nginx\"><code class=\"language-nginx\"><span class=\"token keyword\">server</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">listen</span>         <span class=\"token number\">80</span> default_server<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">listen</span>         <span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span><span class=\"token number\">80</span> default_server<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">server_name</span>    larrykubin<span class=\"token punctuation\">.</span>com www<span class=\"token punctuation\">.</span>larrykubin<span class=\"token punctuation\">.</span>com<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">root</span>           <span class=\"token operator\">/</span>var<span class=\"token operator\">/</span>www<span class=\"token operator\">/</span>html<span class=\"token operator\">/</span>larrykubin<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>public_html<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">index</span>          <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">location</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token variable\">$uri</span><span class=\"token operator\">/</span> <span class=\"token operator\">=</span><span class=\"token number\">404</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">location</span> <span class=\"token operator\">~</span><span class=\"token operator\">*</span> \\<span class=\"token punctuation\">.</span>php$ <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">fastcgi_pass</span> unix<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>run<span class=\"token operator\">/</span>php<span class=\"token operator\">/</span>php7<span class=\"token punctuation\">.</span><span class=\"token number\">2</span><span class=\"token operator\">-</span>fpm<span class=\"token punctuation\">.</span>sock<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">include</span>         fastcgi_params<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">fastcgi_param</span>   SCRIPT_FILENAME    <span class=\"token variable\">$document_root</span><span class=\"token variable\">$fastcgi_script_name</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">fastcgi_param</span>   SCRIPT_NAME        <span class=\"token variable\">$fastcgi_script_name</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo ln -s /etc/nginx/sites-available/larrykubin.com.conf /etc/nginx/sites-enabled/</code></pre></div>\n<h4>It works!</h4>\n<p>After enabling the site and configuring nginx, I restarted PHP and reloaded the nginx configuration. I put a simple test.php script in the public_html directory\nand hit the IP address of the server to make sure everything was working.</p>\n<h5>restarting</h5>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo systemctl restart php7.2-fpm\nsudo nginx -s reload</code></pre></div>\n<h5>test.php</h5>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">echo</span> <span class=\"token double-quoted-string string\">\"hello from php and nginx\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span></code></pre></div>\n<h4>DNS Configuration</h4>\n<p>Since I wanted to use my personal domain for the site, I added DNS records in the Linode DNS Manager, and used GoDaddy to set my nameservers to ns1.linode.com, ns2.linode.com, ns3.linode.com, and ns4.linode.com.\nI waited a while and double checked that the DNS settings propagrated.</p>","frontmatter":{"title":"php on linode","date":"November 18, 2018"}}},"pageContext":{"slug":"/php-on-linode/","previous":{"fields":{"slug":"/hello-gatsbyjs/"},"frontmatter":{"title":"hello gatsby.js"}},"next":{"fields":{"slug":"/lumen-api/"},"frontmatter":{"title":"retrieving music stats with lumen and php"}}}}